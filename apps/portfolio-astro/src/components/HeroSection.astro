---
import CarouselIsland from './CarouselIsland.astro';

export type HeroCarouselItem = {
  src: string;
  alt: string;
  caption?: string;
  emphasis?: 'primary' | 'secondary' | 'supporting';
  motionDelay?: number;
  width?: number;
  height?: number;
};

export type HeroHighlight = {
  kicker?: string;
  title: string;
  summary: string;
  metadata: Array<{ label: string; value: string }>;
  cta: { label: string; href: string; isExternal?: boolean };
};

interface Props {
  id?: string;
  heroTagline: string;
  intro: string;
  bioSnippet?: string;
  featured: HeroHighlight;
  featuredImage?: { asset: string; alt: string };
  carousel: HeroCarouselItem[];
  prefersReducedMotionCopy?: string;
}

const {
  id = 'hero',
  heroTagline,
  intro,
  bioSnippet,
  featured,
  featuredImage,
  carousel = [],
  prefersReducedMotionCopy
} = Astro.props as Props;
---

<section class="hero" id={id} aria-labelledby={`${id}-title`} data-testid="hero-section">
  <div class="hero__content">
    <div class="hero__intro">
      <h1 class="hero__title" id={`${id}-title`}>{heroTagline}</h1>
    </div>

    <article class="hero__highlight">
      <div class="hero__highlight-content">
        <div class="hero__highlight-text">
          {featured.kicker && <p class="hero__highlight-kicker">{featured.kicker}</p>}
          <h2 class="hero__highlight-title">{featured.title}</h2>
          <p class="hero__highlight-summary">{featured.summary}</p>
          <a
            class="hero__cta"
            href={featured.cta.href}
            target={featured.cta.isExternal ? '_blank' : undefined}
            rel={featured.cta.isExternal ? 'noopener noreferrer' : undefined}
          >
            <span>{featured.cta.label}</span>
            <span aria-hidden="true">â†’</span>
          </a>
        </div>
        {featuredImage && (
          <div class="hero__highlight-image">
            <img src={featuredImage.asset} alt={featuredImage.alt} width="150" height="150" />
          </div>
        )}
      </div>
    </article>
  </div>

  {carousel.length > 0 && (
    <CarouselIsland id={`${id}-carousel`} items={carousel} />
  )}
</section>

<style>
  .hero {
    display: contents;
  }

  .hero__content {
    grid-column: 1 / span 12;
    grid-row: 3 / span 3;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-lg);
    padding: var(--space-sm) var(--space-md);
  }

  .hero__intro {
    display: flex;
    flex-direction: column;
    gap: 0;
    flex: 0 0 auto;
    width: 505px;
  }

  .hero__title {
    margin: 0;
    font-family: var(--font-family-heading);
    font-size: var(--font-size-h4);
    line-height: var(--line-height-h4);
    letter-spacing: var(--letter-spacing-h4);
    font-weight: var(--font-weight-h4);
    color: var(--theme-text, var(--color-label-primary));
    white-space: pre-wrap;
  }

  .hero__highlight {
    position: relative;
    padding: var(--space-lg);
    border-radius: 24px;
    background: var(--color-surface-white);
    border: 0.5px solid var(--color-label-quaternary);
    width: 565px;
    flex-shrink: 0;
  }

  .hero__highlight-content {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-sm);
  }

  .hero__highlight-text {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    flex: 1;
    width: 372px;
  }

  .hero__highlight-image {
    flex-shrink: 0;
    width: 150px;
    height: 150px;
    border-radius: 13px;
    overflow: hidden;
  }

  .hero__highlight-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .hero__highlight-kicker {
    margin: 0;
    font-family: var(--font-family-ui);
    font-size: var(--font-size-label-lg);
    line-height: var(--line-height-label-lg);
    letter-spacing: var(--letter-spacing-label-lg);
    text-transform: uppercase;
    color: var(--color-label-secondary);
  }

  .hero__highlight-title {
    margin: 0;
    font-family: var(--font-family-body);
    font-size: var(--font-size-body-md);
    line-height: var(--line-height-body-md);
    letter-spacing: var(--letter-spacing-body-md);
    font-weight: var(--font-weight-body-md);
    color: var(--color-label-primary);
  }

  .hero__highlight-summary {
    margin: 0;
    font-family: var(--font-family-body);
    font-size: var(--font-size-body-md);
    line-height: var(--line-height-body-md);
    letter-spacing: var(--letter-spacing-body-md);
    color: var(--color-label-primary);
  }

  .hero__cta {
    align-self: flex-start;
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-lg);
    background: var(--color-material-regular);
    border: 1px solid var(--color-label-tertiary);
    backdrop-filter: blur(8px);
    font-family: var(--font-family-ui);
    font-size: var(--font-size-label-sm);
    line-height: var(--line-height-label-sm);
    letter-spacing: var(--letter-spacing-label-sm);
    text-transform: uppercase;
    color: var(--color-label-primary);
    transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
    margin-top: var(--space-xs);
  }

  .hero__cta:hover,
  .hero__cta:focus-visible {
    transform: translateY(-1px);
    border-color: var(--color-label-secondary);
    background: color-mix(in srgb, var(--color-surface-white) 60%, transparent);
  }

  .hero :global(.carousel) {
    grid-column: 1 / span 12;
    grid-row: 6 / span 10;
  }

  @media (max-width: 960px) {
    .hero__content {
      flex-direction: column;
      gap: var(--space-lg);
    }

    .hero__highlight {
      width: 100%;
    }

    .hero__highlight-content {
      flex-direction: column;
    }

    .hero__highlight-image {
      width: 100%;
      height: auto;
      aspect-ratio: 1;
    }
  }

  @media (max-width: 720px) {
    .hero__content {
      grid-row: 3 / span 4;
    }
  }
</style>
